<html>
	<head></head>
	<body>
		<div id="log"></div>
		<canvas width=1600 height=1200 style="width:800; height:600"></canvas>
	</body>

	<script>
		const gamepads = {};

		function gamepadHandler(event, connecting) {
		  const gamepad = event.gamepad;

		  if (connecting) {
		    gamepads[gamepad.index] = gamepad;
		  } else {
		    delete gamepads[gamepad.index];
		  }
		  console.log(gamepads);
		}

		window.addEventListener("gamepadconnected", function(e) { gamepadHandler(e, true); }, false);
		window.addEventListener("gamepaddisconnected", function(e) { gamepadHandler(e, false); }, false);


		function gamepadInfo() {
			const gamepads = navigator.getGamepads();
			if (!gamepads) {
				return "";
			}
			let s = "";
			for (let g in gamepads) {
				const gamepad = gamepads[g];
				if (!gamepad) {
					continue;
				}
				const { axes, buttons } = gamepad;
				s += JSON.stringify({
					axes,
				});
			}
			return s;
		}

		function loop() {
			document.getElementById('log').innerText = gamepadInfo();

			requestAnimationFrame(loop);
		}
		requestAnimationFrame(loop);

	</script>
</html>
